# 建表规约
## 通用
### 1. 【强制】【通用】命名不使用拼音，使用英文
对于未知的术语，查询[有道翻译](http://fanyi.youdao.com)，并在之后维护入术语表。  

### 2. 【强制】【通用】所有的字符存储与表示，均以utf-8编码

### 3. 【强制】【通用】表名、字段名必须使用小写字母或数字，英文单词之间以下划线连接
禁止出现数字开头，禁止两个下划线中间只出现数字
**正例**
sale_project / mail_setting
**反例**  
UserAdmin / rdcConfig / level_3_name  
**说明**  
MySQL在Windows下不区分大小写，但在Linux下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。   

## 表
### 4. 【强制】表名不使用复数名词
**说明**  
表名应该仅仅表示表里面的实体内容，不应该表示实体数量。  

### 5. 【强制】【表】表名不需要加上t或tbl等前缀

### 6. 【强制】【表】关联表命名规则
当A表和B表之间存在多对多关系，需要建立一张关联表，关联表命名为a_b_relation。  
**正例**  
user_role_relation

### 7. 【推荐】单表行数超过500万行或者单表容量超过2GB，才推荐进行分库分表

## 字段
### 8. 【强制】主键索引名为pk_字段名；唯一索引名为uk_字段名；普通索引名则为idx_字段名。 
一般情况下不建立数据库外键约束。  

### 9. 【强制】表达是与否概念的字段，必须使用is_xxx的方式命名，数据类型是tinyint，不可为空not null
1表示是（true），0表示否（false）  
**正例**  
表达逻辑删除的字段名`is_deleted`，1表示已逻辑删除，0表示未逻辑删除。   
**注意**  
Java中映射的属性名是去掉`is`的。例如`is_deleted`对应`deleted`。  

如果是在已有的表上新增布尔型字段，可以先设置为允许为空，然后执行SQL语句批量初始化该字段，然后修改为不可为空

### 10. 【强制】时间或日期字段根据精度，后缀以time或date结尾
如果字段类型为`date`，精确到天，则命名为xxx_date  
如果字段类型为`datetime`，精确到时分秒，则命名为xxx_time  

### 11. 【强制】通用字段类型和长度定义
在没有业务含义情况下，使用如下标准来定义表字段类型和长度：
- 布尔型判断字段： tinyint，例如is_deleted，必须为非空not null
- 日期型字段：date
- 日期+时间型字段：datetime
- 表主键：bigint，必须为非空not null
- GUID字段： varchar(36) 
- 数据字典字段：varchar(500)，必须为非空not null
- 名称字段：varchar(200)
- 较长的名称字段/简介字段：varchar(500)
- 特别长的描述字段： varchar(2000)
- 超过2000中文字的字段：text
- 涉及金额的数据字段：decimal(22,2) 
- 涉及净值的数据字段：decimal(24,4)
- 涉及份额的数据字段：decimal(24,4)
- 涉及百分比/费率/利率的数据字段：decimal(24,4)
- 计算中间结果的数据字段：decimal(28,8)
- 业务对象编码字段（例如项目编码，合同编码，产品编码等）：varchar(20)，必须为非空not null

如果需要存储表情，那么选择utf8mb4来进行存储。  
为了避免混淆，除非优化或业务需要，一般我们不使用unsigned的类型。  

### 12. 【强制】表必备五字段：id/create_time/create_user_code/update_time/update_user_code
字段定义及含义如下：  

字段名 | 数据类型 | 备注
-- | -- | --
id | bigint | 单表自增，步长为1，非空
create_time | datetime | 非空，默认值current_timestamp
create_user_code | varchar(50) | 非空
update_time | datetime | 非空，默认值current_timestamp
update_user_code | varchar(50) | 非空

### 13. 【强制】小数类型为decimal，禁止使用float和double
**说明**  
float和double在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不正确的结果。  

### 14. 【强制】创建字段的时候给每个字段加上注释，并在修改字段含义的时候及时更新

### 15. 【强制】必须为非空的字段：表必备五字段/数据字典字段/布尔型判断字段/排序字段/业务对象编码字段
数据字典和布尔型判断字段如果允许为空，会导致开发的时候增加额外不必要的判断逻辑，例如：
```java
		if(Strings.isNullOrEmpty(sysDictValue) || "sys_dict_value".equals(sysDictValue)) {
			// 业务逻辑
		}
```
并使生产上出现NPE的风险大大增加。  
如果是在已有的表上新增这些字段，则需对历史数据进行批量更新后，将字段类型改为非空。  

排序字段如果允许为空，则可能使通过Lambda排序的时候出现异常。  

其他业务上必填的字段，也尽量设置为非空。  

### 16. 【强制】对text字段类型，独立出来一张表，用主键来对应
**说明**  
避免影响其它字段索引效率。 

### 17.  【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致
冗余字段应遵循：  
1）不是频繁修改的字段。  
2）不是varchar(500)以上长度超长字段，更不能是text字段。

